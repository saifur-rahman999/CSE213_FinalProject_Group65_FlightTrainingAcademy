<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<AnchorPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.example.cse213_finalproject_group65_flighttrainingacademy.FinanceAndEnrollmentOfficer.FEODashBoard"
            prefHeight="760.0" prefWidth="1200.0">

    <fx:define>
        <ToggleGroup fx:id="navToggleGroup"/>
    </fx:define>

    <children>
        <BorderPane prefHeight="760.0" prefWidth="1200.0"
                    AnchorPane.topAnchor="0.0" AnchorPane.bottomAnchor="0.0"
                    AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">

            <!-- ========== TOP BAR ========== -->
            <top>
                <HBox spacing="16" alignment="CENTER_LEFT" style="-fx-background-color:#0f172a; -fx-padding:12 16;">
                    <children>
                        <Label text="ðŸ’³ FEO Dashboard â€” Finance and Enrollment"
                               style="-fx-text-fill:white; -fx-font-size:16px; -fx-font-weight:bold;"/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="globalSearchField" promptText="Search applicants, invoices, paymentsâ€¦" prefWidth="360"/>
                        <Button text="Search" onAction="#onGlobalSearch"/>
                        <Separator orientation="VERTICAL" prefHeight="24"/>
                        <MenuButton text="Account">
                            <items>
                                <MenuItem text="Profile" onAction="#onOpenProfile"/>
                                <MenuItem text="Settings" onAction="#onOpenSettings"/>
                                <SeparatorMenuItem/>
                                <MenuItem text="Sign out" onAction="#onSignOut"/>
                            </items>
                        </MenuButton>
                    </children>
                </HBox>
            </top>

            <!-- ========== LEFT NAV ========== -->
            <left>
                <VBox spacing="6" prefWidth="230" style="-fx-background-color:#f8fafc; -fx-padding:12;">

                    <children>
                        <Label text="Navigation" style="-fx-font-weight:bold; -fx-text-fill:#0f172a; -fx-padding:6 4;"/>
                        <ToggleButton text="Overview" toggleGroup="$navToggleGroup" selected="true" onAction="#onNavOverview"/>
                        <ToggleButton text="Applications" toggleGroup="$navToggleGroup" onAction="#onNavApplications"/>
                        <ToggleButton text="Eligibility" toggleGroup="$navToggleGroup" onAction="#onNavEligibility"/>
                        <ToggleButton text="Invoices" toggleGroup="$navToggleGroup" onAction="#onNavInvoices"/>
                        <ToggleButton text="Payments" toggleGroup="$navToggleGroup" onAction="#onNavPayments"/>
                        <ToggleButton text="Summary" toggleGroup="$navToggleGroup" onAction="#onNavSummary"/>
                        <Region VBox.vgrow="ALWAYS"/>
                        <Button text="Backup Data" onAction="#onBackupData"/>
                        <Button text="Restore Data" onAction="#onRestoreData"/>
                    </children>
                </VBox>
            </left>

            <!-- ========== CENTER WORKSPACE ========== -->
            <center>
                <VBox spacing="12" style="-fx-padding:12;">

                    <!-- Filters bar -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <children>
                            <Label text="Filters:" style="-fx-font-weight:bold;"/>
                            <ComboBox fx:id="intakeFilterCombo" promptText="Intake (e.g., 2025-09)" prefWidth="160"/>
                            <ComboBox fx:id="statusFilterCombo" promptText="Status" prefWidth="140"/>
                            <DatePicker fx:id="fromDatePicker" promptText="From date"/>
                            <DatePicker fx:id="toDatePicker" promptText="To date"/>
                            <Button text="Apply" onAction="#onApplyFilters"/>
                            <Button text="Reset" onAction="#onResetFilters"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="New Application" onAction="#onNewApplication" style="-fx-font-weight:bold;"/>
                        </children>
                    </HBox>

                    <!-- KPI Cards -->
                    <HBox spacing="12">
                        <children>
                            <HBox spacing="8" alignment="CENTER_LEFT"
                                  style="-fx-background-color:#eef2ff; -fx-padding:10; -fx-background-radius:10;">
                                <children>
                                    <ImageView fitHeight="28" fitWidth="28"/>
                                    <VBox>
                                        <children>
                                            <Label text="New Applications (30d)" style="-fx-font-size:11px; -fx-text-fill:#334155;"/>
                                            <Label fx:id="newAppsLabel" text="0" style="-fx-font-size:20px; -fx-font-weight:bold;"/>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>

                            <HBox spacing="8" alignment="CENTER_LEFT"
                                  style="-fx-background-color:#ecfeff; -fx-padding:10; -fx-background-radius:10;">
                                <children>
                                    <ImageView fitHeight="28" fitWidth="28"/>
                                    <VBox>
                                        <children>
                                            <Label text="Active Enrollments" style="-fx-font-size:11px; -fx-text-fill:#334155;"/>
                                            <Label fx:id="activeEnrollmentsLabel" text="0" style="-fx-font-size:20px; -fx-font-weight:bold;"/>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>

                            <HBox spacing="8" alignment="CENTER_LEFT"
                                  style="-fx-background-color:#f0fdf4; -fx-padding:10; -fx-background-radius:10;">
                                <children>
                                    <ImageView fitHeight="28" fitWidth="28"/>
                                    <VBox>
                                        <children>
                                            <Label text="Outstanding Balance" style="-fx-font-size:11px; -fx-text-fill:#334155;"/>
                                            <Label fx:id="outstandingBalanceLabel" text="0.00" style="-fx-font-size:20px; -fx-font-weight:bold;"/>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>

                            <HBox spacing="8" alignment="CENTER_LEFT"
                                  style="-fx-background-color:#fff7ed; -fx-padding:10; -fx-background-radius:10;">
                                <children>
                                    <ImageView fitHeight="28" fitWidth="28"/>
                                    <VBox>
                                        <children>
                                            <Label text="Payments This Month" style="-fx-font-size:11px; -fx-text-fill:#334155;"/>
                                            <Label fx:id="paymentsThisMonthLabel" text="0.00" style="-fx-font-size:20px; -fx-font-weight:bold;"/>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>
                        </children>
                    </HBox>

                    <!-- Tabs -->
                    <TabPane fx:id="mainTabPane">
                        <tabs>
                            <!-- Overview -->
                            <Tab text="Overview" closable="false">
                                <content>
                                    <HBox spacing="12" style="-fx-padding:8;">
                                        <children>
                                            <PieChart fx:id="appStatusPieChart" title="Application Status Distribution" prefWidth="420"/>
                                            <BarChart fx:id="revenueBarChart" title="Monthly Revenue" prefWidth="520">
                                                <xAxis><CategoryAxis label="Month"/></xAxis>
                                                <yAxis><NumberAxis label="Amount"/></yAxis>
                                            </BarChart>
                                        </children>
                                    </HBox>
                                </content>
                            </Tab>

                            <!-- Applications -->
                            <Tab text="Applications" closable="false">
                                <content>
                                    <VBox spacing="8" style="-fx-padding:8;">
                                        <children>
                                            <HBox spacing="8">
                                                <children>
                                                    <Button text="New" onAction="#onNewApplication"/>
                                                    <Button text="Edit" onAction="#onEditApplication"/>
                                                    <Button text="Set Eligibility" onAction="#onSetEligibility"/>
                                                    <Button text="Open Invoiceâ€¦" onAction="#onOpenInvoiceForSelected"/>
                                                    <Pane HBox.hgrow="ALWAYS"/>
                                                    <Button text="Export CSV" onAction="#onExportApplicationsCsv"/>
                                                    <Button text="Export PDF" onAction="#onExportApplicationsPdf"/>
                                                </children>
                                            </HBox>

                                            <TableView fx:id="applicationsTable" prefHeight="420">
                                                <columns>
                                                    <TableColumn fx:id="appIdCol" text="App ID" prefWidth="100"/>
                                                    <TableColumn fx:id="nameCol" text="Name" prefWidth="170"/>
                                                    <TableColumn fx:id="emailCol" text="Email" prefWidth="180"/>
                                                    <TableColumn fx:id="intakeCol" text="Intake" prefWidth="100"/>
                                                    <TableColumn fx:id="statusCol" text="Status" prefWidth="120"/>
                                                    <TableColumn fx:id="createdCol" text="Created" prefWidth="140"/>
                                                </columns>
                                                <placeholder><Label text="No applications found."/></placeholder>
                                            </TableView>
                                        </children>
                                    </VBox>
                                </content>
                            </Tab>

                            <!-- Billing (Invoices & Payments) -->
                            <Tab text="Billing" closable="false">
                                <content>
                                    <SplitPane dividerPositions="0.55">
                                        <items>
                                            <!-- Invoices panel -->
                                            <VBox spacing="8" style="-fx-padding:8;">
                                                <children>
                                                    <HBox spacing="8">
                                                        <children>
                                                            <Label text="Invoices" style="-fx-font-weight:bold;"/>
                                                            <Pane HBox.hgrow="ALWAYS"/>
                                                            <Button text="Create Invoice" onAction="#onCreateInvoice"/>
                                                            <Button text="Mark Dispute" onAction="#onMarkDispute"/>
                                                            <Button text="Refundâ€¦" onAction="#onRefund"/>
                                                            <Button text="Refresh" onAction="#onRefreshInvoices"/>
                                                        </children>
                                                    </HBox>
                                                    <TableView fx:id="invoicesTable" prefHeight="360">
                                                        <columns>
                                                            <TableColumn fx:id="invIdCol" text="Invoice ID" prefWidth="120"/>
                                                            <TableColumn fx:id="invAppIdCol" text="App ID/Name" prefWidth="160"/>
                                                            <TableColumn fx:id="invAmountCol" text="Amount" prefWidth="100"/>
                                                            <TableColumn fx:id="invPaidCol" text="Paid" prefWidth="100"/>
                                                            <TableColumn fx:id="invBalanceCol" text="Balance" prefWidth="100"/>
                                                            <TableColumn fx:id="invDueCol" text="Due Date" prefWidth="120"/>
                                                            <TableColumn fx:id="invStatusCol" text="Status" prefWidth="120"/>
                                                        </columns>
                                                        <placeholder><Label text="No invoices."/></placeholder>
                                                    </TableView>
                                                </children>
                                            </VBox>

                                            <!-- Payments panel -->
                                            <VBox spacing="8" style="-fx-padding:8;">
                                                <children>
                                                    <HBox spacing="8">
                                                        <children>
                                                            <Label text="Payments" style="-fx-font-weight:bold;"/>
                                                            <Pane HBox.hgrow="ALWAYS"/>
                                                            <Button text="Add Payment" onAction="#onAddPayment"/>
                                                            <Button text="Refresh" onAction="#onRefreshPayments"/>
                                                            <Button text="Export CSV" onAction="#onExportPaymentsCsv"/>
                                                        </children>
                                                    </HBox>
                                                    <TableView fx:id="paymentsTable" prefHeight="360">
                                                        <columns>
                                                            <TableColumn fx:id="payIdCol" text="Payment ID" prefWidth="120"/>
                                                            <TableColumn fx:id="payInvIdCol" text="Invoice ID" prefWidth="120"/>
                                                            <TableColumn fx:id="payDateCol" text="Date" prefWidth="120"/>
                                                            <TableColumn fx:id="payMethodCol" text="Method" prefWidth="120"/>
                                                            <TableColumn fx:id="payAmountCol" text="Amount" prefWidth="120"/>
                                                            <TableColumn fx:id="payRefCol" text="Reference" prefWidth="160"/>
                                                        </columns>
                                                        <placeholder><Label text="No payments."/></placeholder>
                                                    </TableView>
                                                </children>
                                            </VBox>
                                        </items>
                                    </SplitPane>
                                </content>
                            </Tab>

                            <!-- Summary -->
                            <Tab text="Summary" closable="false">
                                <content>
                                    <VBox spacing="10" style="-fx-padding:8;">
                                        <children>
                                            <HBox spacing="8">
                                                <children>
                                                    <Label text="Summary Period:"/>
                                                    <ComboBox fx:id="summaryPeriodCombo" prefWidth="160"/>
                                                    <Button text="Compute" onAction="#onComputeSummary"/>
                                                    <Pane HBox.hgrow="ALWAYS"/>
                                                    <Button text="Export Summary" onAction="#onExportSummary"/>
                                                </children>
                                            </HBox>
                                            <TableView fx:id="summaryTable" prefHeight="420">
                                                <columns>
                                                    <TableColumn fx:id="sumMetricCol" text="Metric" prefWidth="240"/>
                                                    <TableColumn fx:id="sumValueCol" text="Value" prefWidth="240"/>
                                                </columns>
                                                <placeholder><Label text="Run a summary to see results."/></placeholder>
                                            </TableView>
                                        </children>
                                    </VBox>
                                </content>
                            </Tab>
                        </tabs>
                    </TabPane>
                </VBox>
            </center>

            <!-- ========== RIGHT: QUICK ACTIONS ========== -->
            <right>
                <VBox spacing="10" prefWidth="280" style="-fx-background-color: derive(-fx-base, -8%);">
                    <padding>
                        <Insets top="12" right="12" bottom="12" left="12"/>
                    </padding>
                    <children>
                        <Label text="Quick Actions" style="-fx-font-weight:bold;"/>
                        <Button text="New Applicationâ€¦" onAction="#onNewApplication"/>
                        <Button text="Create Invoiceâ€¦" onAction="#onCreateInvoice"/>
                        <Button text="Add Paymentâ€¦" onAction="#onAddPayment"/>
                        <Separator/>
                        <Label text="Alerts" style="-fx-font-weight:bold;"/>
                        <ListView fx:id="alertsListView" prefHeight="220"/>
                        <Region VBox.vgrow="ALWAYS"/>
                    </children>
                </VBox>
            </right>


            <!-- ========== BOTTOM: STATUS BAR ========== -->
            <bottom>
                <HBox spacing="12" alignment="CENTER_LEFT" style="-fx-background-color:#f1f5f9; -fx-padding:8 12;">
                    <children>
                        <Label fx:id="statusBarLabel" text="Ready."/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <ProgressIndicator fx:id="busyIndicator" prefWidth="22" prefHeight="22" visible="false"/>
                    </children>
                </HBox>
            </bottom>

        </BorderPane>
    </children>

    <padding>
        <Insets top="0" right="0" bottom="0" left="0"/>
    </padding>
</AnchorPane>
